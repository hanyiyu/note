

# 生命周期和作用域

![image-20210922141425543](C:\Users\yhy\AppData\Roaming\Typora\typora-user-images\image-20210922141425543.png)

生命周期和作用域错误使用会导致严重**并发问题**。

## SqlSessionFactoryBuilder

- 一旦创建了SqlSessionFactory,就不再需要它了。
- 局部变量



## SqlSessionFactory

- 可以想象成:数据库连接池
- 一旦被创建就应该在应用的运行期间一直存在，**没有任何理由丢弃它或重新创建另一个实例。**          
- SqlSessionFactory 的最佳作用域是应用作用域。最简单的就是使用单例模式或者静态单例模式。**全局变量，程序开始就开始，程序结束才结束。**



## SqlSession

- 连接到连接池的一个请求
- 每个线程都应该有它自己的 SqlSession 实例。SqlSession          的实例不是线程安全的，因此是不能被共享的，所以它的最佳的作用域是请求或方法作用域。
- 用完之后需要赶紧关闭，否则资源被占用。

![image-20210922141448706](C:\Users\yhy\AppData\Roaming\Typora\typora-user-images\image-20210922141448706.png)

这里面的每个Mapper,就代表一个具体的业务